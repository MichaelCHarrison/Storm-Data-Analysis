---
title: "NOAA Storm Database Analysis"
author: "Michael Harrison"
date: "February 22, 2017"
output:
  html_document: default
  pdf_document: default
---

##Introduction

Storms and other severe weather events can cause both public health and economic problems for communities and municipalities. Many severe events can result in fatalities, injuries, and property damage, and preventing such outcomes to the extent possible is a key concern.

This project involves exploring the U.S. National Oceanic and Atmospheric Administration's (NOAA) storm database. This database tracks characteristics of major storms and weather events in the United States, including when and where they occur, as well as estimates of any fatalities, injuries, and property damage.

Your data analysis must address the following questions:

1. Across the United States, which types of events (as indicated in the ğ™´ğš…ğšƒğšˆğ™¿ğ™´ variable) are most harmful with respect to population health?

2. Across the United States, which types of events have the greatest economic consequences?

### Data Processing; cleanianal cleaningysis

Using the read.csv, data is imported, replacing "?" with "NA" to eliminate unusuable factor level in the variable representing the exponential for property damage

All column names set to lower case for ease in coding; state columns renamed for clarity.

```{r echo=TRUE, cache=TRUE, message=FALSE, results='asis'}
library(data.table); library(dplyr); library(lubridate)
library(xtable)
options(scipen = 999)

stormdt <- fread("StormData.csv")

colnames(stormdt) <- tolower(colnames(stormdt))
colnames(stormdt)[1] <- "fips"
colnames(stormdt)[7] <- "state" 

#change date format
stormdt$bgn_date <- mdy_hms(stormdt$bgn_date)
stormdt$end_date <- mdy_hms(stormdt$end_date)
stormdt <- stormdt[bgn_date >= "1996-01-01"] 

factordmg <- function(DT){
        DT[propdmgexp == "H" | propdmgexp == "h", propdmg := propdmg * 100]
        DT[propdmgexp == "K" | propdmgexp == "k", propdmg := propdmg * 1000]
        DT[propdmgexp == "M" | propdmgexp == "m", propdmg := propdmg * 1E6]
        DT[propdmgexp == "B" | propdmgexp == "b", propdmg := propdmg * 1E9]
        
        for(i in 1:9){stormdt[propdmgexp == i, propdmg := propdmg * 10^i]}
        
        DT[cropdmgexp == "H" | cropdmgexp == "h", cropdmg := cropdmg * 100]
        DT[cropdmgexp == "K" | cropdmgexp == "k", cropdmg := cropdmg * 1000]
        DT[cropdmgexp == "M" | cropdmgexp == "m", cropdmg := cropdmg * 1E6]
        
        DT[cropdmgexp == 0, cropdmg := cropdmg * 10^0]
        DT[cropdmgexp == 2, cropdmg := cropdmg * 10^2]
}

stormdt <- factordmg(stormdt)

stormdt <- stormdt %>% 
        select(fips, state, county, countyname, evtype, 
               bgn_date, bgn_time, end_date, end_time, 
               length, width, f, mag,
               fatalities, injuries, propdmg, cropdmg) %>%
        filter(fatalities > 0 | injuries > 0 | propdmg > 0 | cropdmg > 0)

#knitr::kable(head(stormdt), caption = "Working Table")
```


Fatalities by event type:
```{r cache=TRUE}
event_fatalities <- stormdt %>%
        group_by(evtype) %>%
        summarise(totalfatalities = sum(fatalities)) %>%
        arrange(desc(totalfatalities))
```

Injuries by event type:

```{r cache=TRUE}
event_injuries <- stormdt %>%
        group_by(evtype) %>%
        summarise(totalinjuries = sum(injuries)) %>%
        arrange(desc(totalinjuries))


```



### Results